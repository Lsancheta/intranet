import{r as C,g as y,p as L,b as n,o as l,e as T,d as c,w as U,a as e,t as r,f as g,F,j as E,i as S,u as f,v as D}from"./app-DZv3zm9P.js";import P from"./AppLayout-DHBU2SWw.js";const _={class:"max-w-4xl mx-auto mt-10 bg-white shadow-lg rounded-xl p-6"},q={class:"flex justify-between border-b pb-4"},G={class:"text-2xl font-bold"},H={class:"text-right text-sm"},J={class:"mt-6 border-b pb-4"},K={class:"text-left text-sl"},Q={class:"text-left text-sl"},X={class:"text-gray-700"},Y={class:"mt-6"},Z={class:"w-full border divide-y table-auto"},W={class:"py-2 px-3"},ee={class:"py-2 px-3 whitespace-normal break-words break-all max-w-xs"},te={class:"py-2 px-3"},oe={key:0,class:"mt-3 text-center"},se={key:0,class:"mt-6"},re={key:1,class:"mt-6"},ne={class:"mt-6"},le={class:"grid grid-cols-3 gap-4"},ae=["src"],ie={key:0},de={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center"},me={class:"bg-white p-6 rounded-lg shadow-xl w-96"},ue={class:"flex justify-end mt-4"},fe={__name:"Show",props:{ordem:Object},setup(s){const b=C(!1),x=C(!1),u=s,v=y({comentario:""});function V(){v.post(route("ordens.comentario",u.ordem.id),{onSuccess:()=>{v.reset()}})}const i=y({foto:null});async function j(){if(!i.foto){console.log("Nenhuma foto selecionada");return}try{const a=await O(i.foto,.6,1280);new FormData().append("foto",a),i.foto=a,i.post(route("ordens.foto",u.ordem.id),{forceFormData:!0,preserveScroll:!0,onSuccess:()=>i.reset(),onError:o=>console.log("ERRO MOBILE:",o)})}catch(a){console.log("Erro ao comprimir a imagem",a)}}function O(a,t=.6,o=1280){return new Promise((A,h)=>{const w=new FileReader;w.onload=I=>{const d=new Image;d.src=I.target.result,d.onload=()=>{const m=document.createElement("canvas"),M=m.getContext("2d"),R=o/d.width;m.width=o,m.height=d.height*R,M.drawImage(d,0,0,m.width,m.height),m.toBlob(k=>{if(k){const $=new File([k],a.name,{type:"image/jpeg",lastModified:Date.now()});A($)}else h(new Error("Falha ao comprimir"))},"image/jpeg",t)},d.onerror=()=>h("Erro ao carregar imagem")},w.onerror=()=>h("Erro ao ler arquivo"),w.readAsDataURL(a)})}function z(){b.value=!0}const p=y({comentario:""});function B(){p.post(route("ordens.finalizar",u.ordem.id),{onSuccess:()=>{b.value=!1,p.reset()}})}const N=L(()=>x.value?u.ordem.comentarios:u.ordem.comentarios.slice(0,4));return(a,t)=>(l(),n(F,null,[T(P,null,{default:U(()=>[e("div",_,[e("div",q,[e("h1",G," Ordem de Serviço #"+r(s.ordem.id),1),e("div",H,[e("p",null,[t[5]||(t[5]=e("strong",null,"Status:",-1)),g(" "+r(s.ordem.status.nome),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"Prioridade:",-1)),g(" "+r(s.ordem.prioridade.nome),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Data:",-1)),g(" "+r(s.ordem.created_at),1)])])]),e("div",J,[e("div",K,[e("p",null,[t[8]||(t[8]=e("strong",null,"Condomínio:",-1)),g(" "+r(s.ordem.alojamento.nome),1)])]),e("div",Q,[e("p",null,[t[9]||(t[9]=e("strong",null,"Área:",-1)),g(" "+r(s.ordem.bloco.nome),1)])]),t[10]||(t[10]=e("h2",{class:"font-semibold mb-2 text-lg"},"Descrição",-1)),e("p",X,r(s.ordem.descricao),1)]),e("div",Y,[t[12]||(t[12]=e("h2",{class:"font-semibold mb-3 text-lg"},"Comentários",-1)),e("table",Z,[t[11]||(t[11]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"py-2 px-3 text-left"},"Funcionário"),e("th",{class:"py-2 px-3 text-left"},"Comentário"),e("th",{class:"py-2 px-3 text-left"},"Data")])],-1)),e("tbody",null,[(l(!0),n(F,null,E(N.value,o=>(l(),n("tr",{key:o.id,class:"border-b border-gray-300"},[e("td",W,r(o.user.name),1),e("td",ee,r(o.comentario),1),e("td",te,r(o.created_at),1)]))),128))])]),s.ordem.comentarios.length>4?(l(),n("div",oe,[e("button",{onClick:t[0]||(t[0]=o=>x.value=!x.value),class:"text-blue-600 font-semibold hover:underline"},r(x.value?"Ver menos":"Ver todos os Comentários"),1)])):c("",!0)]),s.ordem.status_id!==4?(l(),n("div",se,[t[13]||(t[13]=e("h2",{class:"font-semibold mb-2 text-lg"},"Adicionar Comentário",-1)),S(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>f(v).comentario=o),rows:"4",class:"w-full border rounded-lg p-3",placeholder:"Escreva um comentário..."},null,512),[[D,f(v).comentario]]),e("button",{onClick:V,class:"mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"}," Enviar Comentário "),e("button",{onClick:z,class:"mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 ml-3"}," Finalizar OS ")])):c("",!0),s.ordem.status_id!==4?(l(),n("div",re,[t[14]||(t[14]=e("h2",{class:"font-semibold mb-2 text-lg"},"Adicionar Foto",-1)),e("input",{type:"file",accept:"image/*",capture:"enviroment",onChange:t[2]||(t[2]=o=>f(i).foto=o.target.files[0]),class:"w-full border rounded-lg p-2"},null,32),e("button",{onClick:j,class:"mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"}," Enviar Foto ")])):c("",!0),e("div",ne,[t[15]||(t[15]=e("h2",{class:"text-lg font-semibold mb-2"},"Fotos",-1)),e("div",le,[(l(!0),n(F,null,E(s.ordem.fotos,o=>(l(),n("div",{key:o.id,class:"border rounded-lg overflow-hidden shadow-sm hover:shadow-lg"},[e("img",{src:`/storage/${o.caminho}`,class:"w-full h-50 object-cover transition-transform duration-300 hover:scale-130 cursor-pointer"},null,8,ae)]))),128))])])])]),_:1}),s.ordem.status_id!==4?(l(),n("div",ie,[b.value?(l(),n("div",de,[e("div",me,[t[16]||(t[16]=e("h2",{class:"text-xl font-semibold mb-3"},"Finalizar OS",-1)),S(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>f(p).comentario=o),rows:"4",class:"w-full border rounded-lg p-3",placeholder:"Digite o comentário final..."},null,512),[[D,f(p).comentario]]),e("div",ue,[e("button",{onClick:t[4]||(t[4]=o=>b.value=!1),class:"bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 mr-2"}," Cancelar "),e("button",{onClick:B,class:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"}," Concluir ")])])])):c("",!0)])):c("",!0)],64))}};export{fe as default};
