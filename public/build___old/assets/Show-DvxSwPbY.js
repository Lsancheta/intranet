import{r as C,g as y,p as $,b as l,o as n,e as L,d as g,w as U,a as e,t as r,f as u,F,j as E,i as S,u as f,v as D}from"./app-D91oiFWV.js";import P from"./AppLayout-BWQ64fhv.js";const q={class:"max-w-4xl mx-auto mt-10 bg-white shadow-lg rounded-xl p-6"},G={class:"flex justify-between border-b pb-4"},H={class:"text-2xl font-bold"},J={class:"text-right text-sm"},K={class:"mt-6 border-b pb-4"},Q={class:"text-left text-sl"},X={class:"text-left text-sl"},Y={class:"text-left text-sl"},Z={class:"text-gray-700"},_={class:"mt-6"},W={class:"w-full border divide-y table-auto"},ee={class:"py-2 px-3"},te={class:"py-2 px-3 whitespace-normal break-words break-all max-w-xs"},oe={class:"py-2 px-3"},se={key:0,class:"mt-3 text-center"},re={key:0,class:"mt-6"},le={key:1,class:"mt-6"},ne={class:"mt-6"},ae={class:"grid grid-cols-3 gap-4"},ie=["src"],de={key:0},me={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center"},ue={class:"bg-white p-6 rounded-lg shadow-xl w-96"},ce={class:"flex justify-end mt-4"},be={__name:"Show",props:{ordem:Object},setup(s){const b=C(!1),x=C(!1),c=s,v=y({comentario:""});function V(){v.post(route("ordens.comentario",c.ordem.id),{onSuccess:()=>{v.reset()}})}const i=y({foto:null});async function j(){if(!i.foto){console.log("Nenhuma foto selecionada");return}try{const a=await O(i.foto,.6,1280);new FormData().append("foto",a),i.foto=a,i.post(route("ordens.foto",c.ordem.id),{forceFormData:!0,preserveScroll:!0,onSuccess:()=>i.reset(),onError:o=>console.log("ERRO MOBILE:",o)})}catch(a){console.log("Erro ao comprimir a imagem",a)}}function O(a,t=.6,o=1280){return new Promise((A,h)=>{const w=new FileReader;w.onload=I=>{const d=new Image;d.src=I.target.result,d.onload=()=>{const m=document.createElement("canvas"),M=m.getContext("2d"),R=o/d.width;m.width=o,m.height=d.height*R,M.drawImage(d,0,0,m.width,m.height),m.toBlob(k=>{if(k){const T=new File([k],a.name,{type:"image/jpeg",lastModified:Date.now()});A(T)}else h(new Error("Falha ao comprimir"))},"image/jpeg",t)},d.onerror=()=>h("Erro ao carregar imagem")},w.onerror=()=>h("Erro ao ler arquivo"),w.readAsDataURL(a)})}function z(){b.value=!0}const p=y({comentario:""});function B(){p.post(route("ordens.finalizar",c.ordem.id),{onSuccess:()=>{b.value=!1,p.reset()}})}const N=$(()=>x.value?c.ordem.comentarios:c.ordem.comentarios.slice(0,4));return(a,t)=>(n(),l(F,null,[L(P,null,{default:U(()=>[e("div",q,[e("div",G,[e("h1",H," Ordem de Serviço #"+r(s.ordem.id),1),e("div",J,[e("p",null,[t[5]||(t[5]=e("strong",null,"Status:",-1)),u(" "+r(s.ordem.status.nome),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"Prioridade:",-1)),u(" "+r(s.ordem.prioridade.nome),1)]),e("p",null,[t[7]||(t[7]=e("strong",null,"Data:",-1)),u(" "+r(s.ordem.created_at),1)])])]),e("div",K,[e("div",Q,[e("p",null,[t[8]||(t[8]=e("strong",null,"Título:",-1)),u(" "+r(s.ordem.titulo),1)])]),e("div",X,[e("p",null,[t[9]||(t[9]=e("strong",null,"Condomínio:",-1)),u(" "+r(s.ordem.alojamento.nome),1)])]),e("div",Y,[e("p",null,[t[10]||(t[10]=e("strong",null,"Área:",-1)),u(" "+r(s.ordem.bloco.nome),1)])]),t[11]||(t[11]=e("h2",{class:"font-semibold mb-2 text-lg"},"Descrição",-1)),e("p",Z,r(s.ordem.descricao),1)]),e("div",_,[t[13]||(t[13]=e("h2",{class:"font-semibold mb-3 text-lg"},"Comentários",-1)),e("table",W,[t[12]||(t[12]=e("thead",{class:"bg-gray-100"},[e("tr",null,[e("th",{class:"py-2 px-3 text-left"},"Funcionário"),e("th",{class:"py-2 px-3 text-left"},"Comentário"),e("th",{class:"py-2 px-3 text-left"},"Data")])],-1)),e("tbody",null,[(n(!0),l(F,null,E(N.value,o=>(n(),l("tr",{key:o.id,class:"border-b border-gray-300"},[e("td",ee,r(o.user.name),1),e("td",te,r(o.comentario),1),e("td",oe,r(o.created_at),1)]))),128))])]),s.ordem.comentarios.length>4?(n(),l("div",se,[e("button",{onClick:t[0]||(t[0]=o=>x.value=!x.value),class:"text-blue-600 font-semibold hover:underline"},r(x.value?"Ver menos":"Ver todos os Comentários"),1)])):g("",!0)]),s.ordem.status_id!==4?(n(),l("div",re,[t[14]||(t[14]=e("h2",{class:"font-semibold mb-2 text-lg"},"Adicionar Comentário",-1)),S(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>f(v).comentario=o),rows:"4",class:"w-full border rounded-lg p-3",placeholder:"Escreva um comentário..."},null,512),[[D,f(v).comentario]]),e("button",{onClick:V,class:"mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"}," Enviar Comentário "),e("button",{onClick:z,class:"mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 ml-3"}," Finalizar OS ")])):g("",!0),s.ordem.status_id!==4?(n(),l("div",le,[t[15]||(t[15]=e("h2",{class:"font-semibold mb-2 text-lg"},"Adicionar Foto",-1)),e("input",{type:"file",accept:"image/*",capture:"enviroment",onChange:t[2]||(t[2]=o=>f(i).foto=o.target.files[0]),class:"w-full border rounded-lg p-2"},null,32),e("button",{onClick:j,class:"mt-3 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"}," Enviar Foto ")])):g("",!0),e("div",ne,[t[16]||(t[16]=e("h2",{class:"text-lg font-semibold mb-2"},"Fotos",-1)),e("div",ae,[(n(!0),l(F,null,E(s.ordem.fotos,o=>(n(),l("div",{key:o.id,class:"border rounded-lg overflow-hidden shadow-sm hover:shadow-lg"},[e("img",{src:`/storage/${o.caminho}`,class:"w-full h-50 object-cover transition-transform duration-300 hover:scale-130 cursor-pointer"},null,8,ie)]))),128))])])])]),_:1}),s.ordem.status_id!==4?(n(),l("div",de,[b.value?(n(),l("div",me,[e("div",ue,[t[17]||(t[17]=e("h2",{class:"text-xl font-semibold mb-3"},"Finalizar OS",-1)),S(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>f(p).comentario=o),rows:"4",class:"w-full border rounded-lg p-3",placeholder:"Digite o comentário final..."},null,512),[[D,f(p).comentario]]),e("div",ce,[e("button",{onClick:t[4]||(t[4]=o=>b.value=!1),class:"bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 mr-2"}," Cancelar "),e("button",{onClick:B,class:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"}," Concluir ")])])])):g("",!0)])):g("",!0)],64))}};export{be as default};
